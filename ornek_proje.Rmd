---
title: "Örnek Proje"
output:
  html_document:
    toc: yes
    toc_depth: 3
    number_section: yes
    highlight: tango
  word_document:
    toc: yes
    toc_depth: '3'
    number_section: yes
---
```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
library(dlookr)
library(flextable)
library(ggpubr)
library(skimr)
```

Bu doküman istatistik dersinde öğrencilerin yapacakları projelerde yardımcı olmak için hazırlanmıştır. 


# Projenin Konusu ve Amacı

Bu projede farklı araç tiplerinin yakıt tüketimleri ile ilgili istatistiksel analizler yapılacaktır. Bu amaçla, `tidyverse` paketi içinde yer alan `mpg` veri seti kullanılacaktır. Bu veri seti 1999-2008 yılları arasında üretilen otomobillerin yakıt ekonomisi ile ilgili verileri içermektedir. Bu veri setini kullanabilmek için tidyverse paketinin `library()` fonksiyonu ile aktif hale getirilmesi gereklidir. 

```{r, warning=FALSE,message=FALSE}
library(tidyverse)
```
Ayrıca aşağıdaki paketler de kullanılmıştır.

* kableExtra
* dlookr
* flextable
* ggpubr
* skimr

İlk olarak, `head()` fonksiyonu ile `mpg` veri setindeki  ilk 6 gözlemi tablo formatında yazdıralım. Tablo oluşturmak için `knitr` paketi içindeki `kable()` fonksiyonununu kullanabiliriz. Bu tabloya `caption` seçeneği ile bir açıklama yazısıda ekleyebiliriz. 

```{r, mpgdata, warning=FALSE}
head(mpg)%>% 
    knitr:: kable(caption = "mpg veri seti")%>%
    kableExtra::kable_classic(full_width=FALSE)
```

Tablodaki değişkenlerin açıklamaları aşağıdaki gibidir.

* `manufacturer:` Üretici 
* `model:` Aracın modeli
* `displ:` Motor hacmi
* `year:` Üretim yılı
* `cyl:` silindir sayısı
* `trans:` Vites tipi (manuel veya otomatik)
* `drv:` Çekiş tipi (önden çekişli, arkadan çekişli veya 4x4)
* `cty:` Şehir içi yakıt tüketimi
* `hwy:` Şehir dışı yakıt tüketimi
* `fl:` Yakıt tipi (e: etonol, p:premum yakıt, d: dizel, c: CNC, r=normal (regular))
* `class:` Sınıf

## Verilerin Temizlenmesi

İstatisitksel analizler için toplanan veriler çoğu zaman doğrudan kullanıma hazır değildir. Verilerin toplanması veya bilgisayara aktarılması sırasında yazım hataları, eksik gözlemler, analizlerde gerekli olmayan gözlemler toplanmış olabilir. Diğer taraftan, analizler için gerekli ancak veriler toplanırken dikkate alınmayan değişkenlerinde veri setine eklenmesi gerekli olabilir. Ayrıca, veriler okunurken  R tarafından otomatik olarak belirlenen değişken tipleri yanlış veya uygun olmayabilir. Bu nedenle analizlere başlamadan önce veri içindeki hataların düzeltilmesi, eksik gözlemlerin silinmesi, fazla değişkenlerin silinmesi, yeni değişkenlerin eklenmesi, değişken tiplerinin uygun hale getirilmesi gibi işlemlerin yapılması gerekmektedir. Bu işlemler veri temizleme olarak isimlendirilir.  


### Değişken Tiplerinin Değiştirilmesi

Veri setindeki değişken tiplerinin istatistiksel analizler veya grafikler için uygun hale getirilmesi gereklidir. Veri setindeki değişkenlerin tiplerini `str()` fonksiyonu ile görebiliriz.

```{r}
str(mpg)
```

Yukarıdaki listede `mpg` veri setinde yer alan değişkenlerin isimleri, tipleri, gözlem sayıları ve değişkenlere ait bir kaç gözlem değeri örnek olarak verilmektedir. 

R programı sözel gözlemleri içeren değişkenleri `chr`, tamsayı gözlemleri içeren değişkenleri `int` ve ondalıklı gözlemleri içeren değişkenleri ise `num` olarak belirler. `chr` tipinde olan değişkenleri `Factor` tipine dönüştürmek grafiklerin çizilmesinde ve istatisitsel analizlerin yapılmasında kolaylık sağlamaktadır. Bu nedenle `chr` tipindeki değişkenleri `Factor` tipine dönüştürülmesi gerekir. `as.factor()` fonksiyonu ile bir değişkenin tipi `Factor` tipine dönüştürülebilir. Örneğin `trans` değişkenini faktör tipine dönüştürmek için aşağıdaki komutu kullanabiliriz.


```{r}
mpg$trans<-as.factor(mpg$trans)
```

Karakter tipindeki değişkenlerin tümünü fakör tipine dönüştürmek için `dplyr` paketi içindeki `mutate_if()` fonksiyonunu kullanabiliriz.

```{r}
mpg <- mpg %>% mutate_if(is.character, as.factor)
```

Veri setinde bazı değişkenler sayısal değer almasına rağmen bu değişkenler aslında kategorik nitelikte olabilir. Örneğin, `mpg` veri setinde `year` ve `cyl` değişkenleri araçları üretim yıllarına ve silindir sayılarına göre sınıflandırmak için kullanılan değişkenlerdir. Bu değişkenler üzerinden aritmatik işlemler yapılmayacağından faktör tipine dönüştürebiliriz.  

```{r}
mpg$year<-as.factor(mpg$year)
mpg$cyl<-as.factor(mpg$cyl)
```

Bu işlemler sonucunda değişken tipleri aşağıdaki gibi düzenlenmiş olur.

```{r}
str(mpg)
```


### Gözlemlerin Düzenlenmesi

Verilerin toplanması veya bilgisayara aktarılması sırasında birtakım hatalar oluşabilir. Özellikle kategorik değişkenlerde yazım hataları ile sık sık karşılaşılmaktadır. Bu hataların tespit edilerek düzeltilmesi gerekmektedir.

Örneğin `mpg` veri setinde `trans` değişkeni altında vites tiplerinin detaylı bir şekilde girildiği görülmektedir. Bu detay bilgiler gerekli değil ise vites tiplerini genel olarak *auto* ve *manual* olmak üzere iki grup altında toplayabiliriz. Bu amaçla "auto" kelimesini içeren gözlemleri "auto", "manual" kelimesini içeren gözlemleri ise "manual" olarak değiştirebiliriz. Bu nedenle ilk harfi "a" olan gözlemleri "auto" diğerlerini ise "manual" olarak değiştirelim. Bu işlemi `ifelse()` ve `substring()`fonksiyonlarını kullanarak yapabiliriz. `ifelse()` fonksiyonu verilen bir koşul doğru ise bir ifadenin değilse diğer ifadenin yapılmasını sağlamaktadır. `substring()` fonksiyonu ise bir metin dizisi içinde ilk ve son değerler arasında yer alan karakter dizisini vermektedir.     

```{r}
mpg$trans <- ifelse(substring(mpg$trans, first=1, last=1)== "a", "auto", "manual") %>%as.factor()
```

### Değişkenlerin Silinmesi ve Yeni Değişken Eklenmesi

Bazı veri setlerinde analizlerde kullanılmayacak değişkenlere ait bilgiler bulunabilir bu nedenle bu değişkenlerin silinmesi gerekebilir. R programında değişkenleri silmek için farklı yöntemler bulunmaktadır. Birinci olarak, silinecek değişkenlere `NULL` ataması yapılabilir.   

```{r eval=FALSE}
# manufacturer değişkenini silmek için
mpg$manufacturer <- NULL

# 1. sıradaki değişkeni silmek için
mpg[1] <- NULL

# 1, 3 ve 4. sıradaki değişkenleri silmek için
mpg[c(1,3,4)] <- NULL

```

İkinci olarak, değişkenin veri setinde yer aldığı sıra numarasının önüne `-` işareti konulabilir.

```{r eval=FALSE}
# 2. sıradaki değişkeni silmek için
mpg <- mpg[-2]
```

Üçüncü olarak, değişkenleri silmek yerine sadece gerekli değişkenler seçilebilir. 

```{r eval=FALSE,warning=FALSE}
# veri setinden sadece 3., 10. ve 11. sıradaki değişkenleri  seçmek için 
mpg <- mpg[c(3,10,11)]
```

Veri setindeki değişkenleri seçmek için `dplyr` paketindeki `select()` fonksiyonu kullanabiliriz. 

```{r eval=FALSE,warning=FALSE}
# cyl ve drv sütunlarını seçmek için
mpg<-mpg %>% select(cyl, drv)
```

Mevcut veri setinde yer almayan fakat analizler için gerekli değişkenlerin veri setine eklenmesi gerekebilir. Bu değişkenler ya mevcut değişkenlerden hesaplanabilir veya başka bir veri setinden kopyalanabilir. Yeni bir değişkenin bir sütun olarak eklenmesi için \$ işareti ile oluşturulabilir. Örneğin, `mpg` veri setine bir galon yakıt ile şehir içi ve şehir dışında gidilecek ortalama mesafe için `mean_mpg` isminde yeni bir değişken  oluşturmak için `mpg$mean_mpg` komutu ile veri setine yeni bir sütun eklenir. Ortalama mesafeyi  hesaplamak için şehir içi yakıt tüketiminin %70'i ve şehir dışı yakıt tüketimin %30'u alınmaktadır.  

```{r warning=FALSE}
mpg$mean_mpg <- 0.7*mpg$cty + 0.3*mpg$hwy
head(mpg, 6)%>%flextable()
```

Veri setine yeni bir değişken ekleme işlemini alternatif olarak `dplyr` paketi içindeki `mutate()` fonksiyonunu ile yapabiliriz.  

```{r eval=FALSE,warning=FALSE}
mpg <- mpg%>%mutate(mean_mpg=0.7*cty+0.3*hwy)

```

### Eksik Gözlemlerin Silinmesi

Veri setlerinde bazı gözlemlere ait bilgi olmadığı veya unutulduğu için boş bırakılmış olabilir. R programı ile veriler okunurken tüm boşluklar eksik gözlem olarak değerlendirilir ve eksik gözlemler `NA` şeklinde etiketlendirilir. Eksik gözlemler barındıran veri setlerinde nasıl bir yaklaşım izleneceği veri setinin büyüklüğüne ve eksik gözlem saysına bağlı olarak belirlenmelidir. Eksik gözlemler tamamen veya  kısmen silinebilir. Eksik gözlemlerin silinmesi zorunlu olmadıkça tercih edilmemelidir. Bunun yerine, analizler sırasında eksik gözlemlerin çıkarılması veri kaybının önüne geçeceği için tercih edilmelidir. Pek çok R fonksiyonunda yer alan `na.rm` seçeneği `na.rm=TRUE` şeklinde belirtilirek eksik gözlemler analiz sırasında çıkarılabilmektedir.  Örneğin ortalamaları hesaplamak için kullanılan `mean()` fonksiyonunda `na.rm=TRUE` olarak belirtilir ise eksik gözlemler çıkarılarak ortalamalar hesaplanır.

```{r eval=FALSE}
mean(mpg$cyl, na.rm = TRUE)
```


Eksik gözlemleri silmek yerine diğer bir seçenek eksik gözlemleri tahmin etmektir. Özellikle küçük veri setlerinde bu yöntem tercih edilmelidir. Sayısal değişkenlerdeki eksik gözlemleri tahmin etmek için aritmetik ortalama veya medyan, kategorik değişkenlerde ise mod (en sık tekrar eden değer) gibi basit istatistikler kullanılabilir. Bu basit istatistikler dışında daha karmaşık tahmin yöntemleri de mevcuttur. 

Veri setinde gözlem olup olmadığını kontrol etmek için  `is.na()` fonksiyonu kullanabiliriz. Bu fonksiyon eksik gözlemler için `TRUE` diğer durumda `FALSE` sonucunu vermektedir.

```{r}
a=c(1,NA,4)
is.na(a)
```

Bir veri setinde kaç tane eksik veri olduğunu bulmak için ise `sum()` fonksiyonunu kullanabiliriz. `sum()` fonksiyonu `TRUE` veya `FALSE` gibi mantıksal değerleri içeren dizilerde `TRUE` sayısını vermektedir.  

```{r}
sum(is.na(c(1,NA,4)))
```

`mpg` veri setinde eksik gözlem olup olmadığını belirlemek için aşağıdaki komutu kullanabiliriz.

```{r}
sum(is.na(mpg))
```

Her değişkendeki eksik gözlemleri görmek için `skimr` paketi içindeki `diagnose()` kullanabiliriz. Bu paket R deki `summary()` fonksiyonuna alternatif olarak geliştirilmiştir.

```{r}
diagnose(mpg)%>%flextable()
```

Bir veri setinde yer alan eksik gözlemlerin tümünü silmek için `na.omit()` fonksiyonu kullanılabilir.

```{r}
mpg<-mpg%>%na.omit()
```

Bir veya daha fazla sütunda bulunan eksik verileri silmek için `dplyr` paketi içindeki `drop_na()` fonksiyonu kullanılabilir. Örneğin `cyl` ve `hwy` değişkenleri içindeki eksik gözlemleri silmek için aşağıdaki komutu kullanabiliriz.  

```{r eval=FALSE}
mpg%>%drop_na(cyl,hwy)
```

### Gözlemlerin Dağılımındaki Dengesizliklerin Tespit Edilmesi

Kategorik değişkenler üzerinde yapılan analizlerde değişkenlerin sahip olduğu tüm seviyeler için veri setinde yeterli sayıda gözlem ve seviyelerin dağılımı eşit olması önemlidir. Bu nedenle analizlerin başında her değişken için gözlemlerin dağılımları tespit edilmelidir. Örneğin silindir sayısına göre araçların dağılımını bulalım. Bunun için `dplyr` paketi içindeki `sellect()`, `group_by()` ve `summarise()` fonksiyonlarını kullanabiliriz. `group_by()` fonksiyonu bir değişkenin her seviyesini bir grup altında toplamaktadır. `summarise()` fonksiyonu ise özet bilgileri vermek için kullanılır. `summarise()` fonksiyonu içindeki `n()` fonksiyonu her bir gruptaki gözlem sayısını verir.  

```{r}
mpg%>%
    select(cyl)%>%
    group_by(cyl)%>%
    summarise(sayı=n())%>%
  knitr::kable()%>%
  kable_classic(full_width=FALSE)
```

`Factor` tipindeki değişkenlerin dağılımını toplu bir şekilde görmek için aşağıdaki komutu kullanabiliriz. Bunun için `summary()` fonksiyonunu kullanabiliriz. Bu fonksiyon veri setindeki değişkenlerin tipine bağlı olarak özet istatistikleri vermektedir. Sayısal değişkenler için ortalama, medyan, 1.çeyrek, 3. çeyrek, minimum ve maksimum değerleri verirken, diğer değişken tipleri için ise değişkenleri frekanslar verilir.

```{r}
summary(mpg%>%
  select_if(is.factor))
```

Yukarıdaki sonuçlar incelendiğinde `cyl`, `drv` ve `fl` kategorik değişkenlerindeki seviyelerde gözlemlerin dengeli bir şekilde dağılmadığı görülmektedir. 

İki veya daha fazla değişkenlerdeki gözlemlerin dağılımını birlikte görmek için `dplyr` içindeki `group_by()` ve `summarise()` fonksiyonlarını kullanabiliriz. Örneğin, üretici ve model  sayılarına göre gözlemlerin dengeli bir şekilde dağılıp dağılmadığını görmek için aşağıdaki komutu kullanabiliriz.

```{r, warning=FALSE}
mpg%>%
  group_by(manufacturer,model)%>% 
  summarise(Gozlem_sayisi=n())%>%
  kable(col.names=c("Üretici","Model","Gözlem Sayısı"))%>%
  kable_classic(full_width=FALSE)
```

## İstatistiklerin Hesaplanması

Veri setindeki değişkenlerin frekansları, ortalamaları, vb.  istatistikler veri seti hakkında genel bilgiler elde etmek için analizler öncesinde hesaplanmalıdır.Bu amaçla R'deki `summary()` fonksiyonu kullanılabilir.  

```{r}
summary(
  mpg%>%select_if(is.numeric)
  )%>%
  knitr::kable()%>%
  kable_classic(full_width=FALSE)
```

Sayısal değişkenlerin sadece ortalamalerını hesaplamak içinaşağıdaki komutu kullanabiliriz. Bu komutta `mean` ortalamaların hesaplanacağını belirtmektedir.

```{r}
mpg%>%summarise_if(is.numeric,list(ort=mean))%>%
  knitr::kable()%>%
  kable_classic(full_width=FALSE)
```

Ortalama ile birlikte medyan değerlerini hesaplamak için aşağıdaki komut kullanılabilir.

```{r}
mpg%>%summarise_if(is.numeric,list(ort=mean, medyan=median))%>%
  knitr::kable()%>%
  kable_classic(full_width=FALSE)
```
## Hipotez Testleri

Bir veya daha fazla anakütle hakkında ortaya atılan iddiaların doğruluğunu araştırmak için yapılan testlere hipotez testleri denir.

Hipotez testleri için ilk olarak bir iddanın oluşturulması gerekir. Bu iddia daha önceden belirlenmiş olabilir veya toplanan verilerden oluşturulabilir. Toplanan verilerden hareketle bir iddia oluşturmak için grafikler veya istatistiklerden faydalanır. Örneğin yıllar itibariyle araçların yakıt tüketimlerinde bir değişim olup olmadığını hipotez testi ile araştırmak istediğimizi varsayalım.  Bu araştırmanın iddiasını oluşturmak için araçların yakıt tüketiminde bir değişim olup olmadığını kutu grafiğini kullanarak inceleyebiliriz.

```{r}
mpg%>%group_by(year)%>%ggplot()+
  aes(x=year, y=mean_mpg)+
  geom_boxplot(aes(colour=year))+
  labs(
    x="Yıllar", 
    y="Galon Başına Mesafe (mpg)", 
    title = "Yıllara göre bir galon yakıt ile gidilen mesafeler"
    )
```

Yukarıdaki grafikte kutular birbirine hizalı ve medyan değerleri birbirine yakın olduğu için araçların yakıt tüketimlerinde çok fazla bir değişim olmadığı, ancak, 1999 yılında bazı araçların (nokta ile gösterilen değerler) bir galon yakıt ile çok daha fazla mesafe gittiği görülmektedir. Bu nedenle iddiayı yıllar itibari ile araçların ortalama mesafelerinde bir değişim yoktur şeklinde oluşturabilriz. 

Bir iddia oluşturmak için grafiklere ilave olarak sayısal göstergelerden de faydalanılabilir. Örneğin 1999 ve 2008 yıllarında üretilen araçların ortalma mesafelerini hesaplayarak   iddayı oluşturabiliriz. Ortalamaları hesaplamak için önce `group_by()` fonksiyonu ile  gözlemleri yıl bazında gruplandırarak `summarise()` fonksiyonu ortalamaları hesaplayalım.

```{r}
mpg%>%group_by(year)%>%
  summarise(mean=mean(mean_mpg))%>%
  knitr::kable(
    col.names=c("Yıllar", "Ortalama Yakıt Tüketimi"),
    digits = 3
    )%>%
  kable_styling(full_width = FALSE)
```

Yukarıdaki tablodan da görüldüğü gibi araçların galon başına ortalama mesafeleri birbirine çok yakın çıkmıştır. Bu sonuç araçların yakıt tüketimi konusunda yıllar itibariyle çok fazla bir değişim olmadığını göstermektedir. 

Ortalama değerler ve kutu grafiği yıllar itibariyle araçların yakıt tüketimlerinin çok fazla değişmediğini göstermektedir. Ancak bu konuda kesin kararımızı ancak istatistiksel testler ile verebiliriz. "Yıllar itibari ile araçların bir galon yakıt ile gittikleri mesafe aynıdır" iddiasını araştırmak için aşağıdaki hipotezleri oluşturalım.

$$H_0: \mu_{1999}=\mu_{2008}\\
H_1: \mu_{1999} \ne \mu_{2008}$$

Burada $\mu_{1999}$ ve $\mu_{2008}$ yıllara göre araçların bir galon yakıt ile gittikleri ortalama mesafeleri temsil etmektedir. Bu iddianın doğruluğunu  t-testi ile araştırabiliriz. 

### t-Testi

Bir veya iki anakütle ortalamaları veya oranları ilgili iddiaları araştırmak için t-testini kullanılabilir. t-testini kullanabilmek için verilerin normal dağılıma sahip olması gerekir. Bu nedenle önce verilerin normal dağılıma sahip olup olmadığı belirlenmelidir. Verilerin normal dağılıma sahip olup olmadığını grafik yöntemler veya   istatistiksel testler ile belirlenmektedir. Grafik yöntemde gözlemlerin olasılık yoğunluk fonksiyonu veya histogram grafiğine bakılabilir. Eğer bu grafikler normal dağılıma yakın ise verilerin normal dağılıma sahip olduğunu söyleyebiliriz. Örneğin araçların üretim yıllarına  göre bir galon benzin ile gittikleri ortalama mesafelerin olasılık yoğunluk grafiğini çizelim. 

```{r warning=FALSE}
ggplot(mpg, aes(x = mean_mpg)) +
  geom_density(colour = "black") +
  facet_grid(year ~ .)
```

Bu grafiklerden verilerin kısmen normal dağılıma  sahip olduğu görülmektedir. 

Verilerin normalliğini araştırmak için kullanılan ikinci grafik yöntem Q-Q grafiğidir (quantile-quantile plot). Q-Q grafiğinde tüm noktalar bir doğru üzerinde yer alıyor ise verilerin normal dağılıma sahip olduğu sonucuna varılır. Q-Q grafiğini `ggplot2` paketi içindeki `stat_qq()` ve `stat_qq_line()` fonksiyonları kullanarak çizebiliriz. 

```{r}
ggplot(data=mpg, aes(sample=mean_mpg))+
 stat_qq(distribution = qnorm)+
  stat_qq_line(distribution = qnorm)+
  facet_grid(.~year)
```

İlk grafikten noktaların bir kısmı çizgi üzerinde bulunmadığı için verilerin normal dağılıma sahip olmadığını ikinci grafikten ise kısmen normal dağılıma sahip olduğu görülmektedir. 

Q-Q grafiği alternatif olarak `ggpubr` paketinde `ggqqplot()` fonksiyonu kullanılarak çizilebilir. Bu grafikteki gölgeli kısım güven aralığı olarak isimlendirilir ve normallik varsayımının sağlandığı alanı temsil eder. 

```{r}
ggqqplot(mpg, "mean_mpg", facet.by="year",)
```

Yukarıdaki grafikte 1999 yılında araçlara ait gözlemlerin bir kısmı güven aralığının dışında olduğundan normallik varsayımının sağlanmadığını söyleyebiliriz. 

**Shapiro-Wilk Testi**

Grafik yöntemler ile bulunan sonuçlar verilerin normal dağılıma sahip olup olmadığını belirlemek için yeterli değildir. Nihai karar ancak istatistiksel testler ile verilebilir. Normallik testi için parametrik veya parametrik olmayan testler kullanılabilir. Shapiro-Wilk testi normallik için kullanılan parametrik testlerden birisidir. Normallik için aşağıdaki hipotezler test edilir.

$$
\begin{align}
&H_0: \text{Veriler normal dağılıma sahiptir}\\
&H_1: \text{Veriler normal dağılıma sahip değildir}
\end{align}
$$
Shapiro-Wilk testini `dlookr` paketi içindeki `normality()` fonksiyonunu kullanarak gerçekleştirebiliriz.  

```{r}
mpg %>%
  group_by(year) %>%
  normality(mean_mpg)%>%flextable()
```

Shapiro-Wilk testi sonucunda hesaplanan $p_{değeri}<0.05$ ise $H_0$ hipotezi reddedilir. Yukarıdaki tabloda 1999 yılındaki araçların ortalama yakıt tüketimleri normal dağılıma sahip olmadığı $(0.0000047<0.05)$ ve 2008 yılındaki araçların ortalama yakıt tüketimlerinin ise normal dağılıma sahiptir hipotezi reddedilemiştir $(0.0505>0.05)$. 

Grafikler ve Shapiro-Wilk testi sonuçlarından 1999 yılına ait verilerin normal dağılıma sahip olmadığını söyleyebiliriz.

Eğer veriler normal dağılıma sahip değil ise uygun bir dönüşüm ile verilerin normal dağılıma sahip olması sağlanabilir. Dönüşüm için gözlemlerin logoritması veya karekökü vb. alınabilir. Eğer yapılan dönüşümler sonunda veriler normal dağılıma sahip olmuyor ise parametrik olmayan testler tercih edilmelidir.

Ortalama yakıt tüketimine ait veriler normal varsayımını sağlamamakla birlikte t-testinin uygulamasını göstermek adına hipotez testine devam edelim. 

R programında t-testini yapmak için `t.test()` fonksiyonunu kullanılır. t-testi bir veri setinde iki farklı grubu karşılaştırmak için yapmak için **test değişkeni** ve **gruplama değişkeni** olmak üzere iki değişken belirlenmelidir.  Gruplama için kullanılacak değişkende en fazla iki farklı seviye olmalıdır. Test ve gruplama değişkenlerini belirtmek için R programında  `test_değişkeni~gruplama_değişkeni` şeklinde bir formül oluşturulur. Bir galon benzin ile gidilen ortalama mesafe (`mean_mpg`) test değişkeni ve  yıllar (`year`) gruplama değişkeni olmak üzere `mean_mpg~year` formülü ile yıl bazında araçlar gruplandırılırak ortalama mesafeleri test edilir. `year` değişkeninde 1999 ve 2008 model araçlar olduğundan bu iki yıldaki sağlanmaktadır. Hipotez testinde alternatif hipotez $(\ne)$ olduğunda `alternative="two.sided"`şeklinde belirtilmiştir. t-testi yaparken dikkat edilmesi gereken bir diğer husus iki grubun varyansların eşit olup olmadığıdır. Varyansların eşit olup olmamasına göre farklı istatistikler kullanıldığından bu durumun öncenden tespit edilmesi gerekir. Eğer varyansların istatistiksel olarak eşit olduğu biliniyor ise `var.equal=TRUE`şeklinde belirtilmelidir. Bu örnek için varyansların eşit olduğunu varsayalım. 


```{r}
test=t.test(data=mpg, mean_mpg~year, alternative="two.sided", var.equal=TRUE)
test
```

Yukarıdaki sonuçlarda $p_{değeri}=`r format(test$p.value,digit=4)`>0.05$ olduğundan $H_0$ hipotezi reddedilemez. Eğer varyansların eşit olmadığını varsayar isek
```{r}
test=t.test(data=mpg, mean_mpg~year, alternative="two.sided", var.equal=FALSE)
test
```
Yukarıdaki sonuçlarda $p_{değeri}=`r format(test$p.value,digit=4)`>0.05$ olduğundan $H_0$ hipotezi reddedilemez. Yıllara göre araçlaların ortalama mesafelerinde bir değişim olmamıştır.

İkinci olarak, otomatik vitesli araçların düz vitesli araçlara göre daha fazla yakıt tükkettiği şeklinde bir görüş vardır. Bu görüşün doğruluğunu araştırmak için otomatik ve düz vitesli araçların ortalama yakıt tüketimlerini hesaplayalım.

```{r}
mpg%>%group_by(trans)%>%
  summarise(mean=mean(mean_mpg))%>%
  knitr::kable(
    col.names=c("Vites Tipi", "Ortalama Mesafe"),
    digits = 3
    )%>%
  kable_styling(full_width = FALSE)
```

Tablodan da görüldüğü düz vitesli araçlar galon başına ortalama 3 mil daha fazla yol yapmaktadır.

Vites tipine göre araçların bir galon benzin ile gittikleri mesafeleri kutu grafiği ile gösterebiliriz. Aşağıdaki grafikten görüldüğü gibi düz vitesli araçlar otomatik vitesli araçlara göre daha fazla mesafe kat etmekedirler.

```{r}
ggplot(mpg)+
  aes(x=trans, y=mean_mpg)+
  geom_boxplot()+
  labs(
    x="Vites Tipi", 
    y="Ortalama Mesafe (mpg)", 
    title = "Vites tipine göre Ortalama Mesafe"
    )
```


Otomatik vitesli araçların düz vitesli araçlara göre ortalama mesafelerin daha kısa olduğu iddiasını doğru olup olmadığını verilerin normal dağılıma sahip olduğunu varsayarak t testi ile belirleyelim. Bunun için hipotezleri aşağıdaki gibi oluşturabiliriz.

$$H_0: \mu_{auto}=\mu_{manual}\\
H_1: \mu_{auto}<\mu_{manual}$$
```{r}
test2=t.test(data=mpg, mean_mpg~trans, var.equal=TRUE)
test2
```
Yukarıdaki sonuçlarda $p_{değeri}=`r format(test2$p.value,digit=4)`<0.05$ olduğundan $H_0$ hipotezi reddedilir. Otomatik vitesli araçlar bir galon benzinle ortalama olarak daha kısa mesafe kattemektedirler.

### Ki-kare testi

Vites sayısı ile vites tipi arasında bir ilişki olup olmadığını belirleyelim
```{r}
ggplot(mpg,aes(x=cyl, fill=trans))+
  geom_bar(position = "fill")+
  stat_count(geom = "text", 
             aes(label = paste( "%", round((..count..)/sum(..count..)*100))),
             position=position_fill(vjust=0.5), colour="white",size=8)
```

Grafikten vites sayısı arttıkça araçların daha çok otomatik vitesli olduğu görülmektedir. Yani, vites sayısı ve vites tipi arasında bir ilişki varmış gibi görünmektedir. Bu ilişkinin doğruluğunu araştırmak için aşağıdaki hipotezleri test edebiliriz. 

$$
\begin{align}
&H_0: \text{Silindir sayısı ve vites tipi arasında ilişki yoktur}\\
&H_1: \text{Silindir sayısı ve vites tipi arasında ilişki vardır}
\end{align}
$$
Bu hipotezi test etmek için vites sayısı ve tipine göre araçların sayılarını tespit etmemiz gerekir. Aşağıdaki tabloda bu sayılar verilmektedir. Bu tablo **çapraz tablo** olarak isimlendirilir. R programında çapraz tablo oluşturmak için `table()` fonksiyonu kullanılır. Çapraz tablolar bir veya daha fazla değişken için kullanılabilir. Ki-kare testleri için tabloların en falza iki boyutlu olması zorunludur. 

```{r}
tablo <- table(mpg$cyl, mpg$trans)
tablo
```

Ki-kare testini gerçekleştirmek için `chisq.test()` fonksiyonu kullanılır. 

```{r}
chisq.test(tablo,correct = TRUE)
```

$p_{değeri}<0.05$ olduğundan $H_0$ hipotezi reddedilir. Vites sayısı ve vites tipi arasında ilişki vardır. 
